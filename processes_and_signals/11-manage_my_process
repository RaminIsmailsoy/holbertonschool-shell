#!/usr/bin/env bash

PIDFILE="/var/run/my_process.pid"
PROCESS="./my_process"

start() {
    if [ -f "$PIDFILE" ]; then
        echo "my_process already running"
        exit 1
    fi

    $PROCESS &
    echo $! > "$PIDFILE"
    echo "manage_my_process started"
}

stop() {
    if [ ! -f "$PIDFILE" ]; then
        echo "my_process not running"
        exit 1
    fi

    kill "$(cat "$PIDFILE")" 2>/dev/null
    rm -f "$PIDFILE"
    echo "manage_my_process stopped"
}

restart() {
    stop 2>/dev/null
    start
    echo "manage_my_process restarted"
}

# ----------------------
# MAIN
# ----------------------

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    *)
        echo "Usage: manage_my_process {start|stop|restart}"
        exit 1
        ;;
esac
